<!DOCTYPE html>
<html>
<head>
<title>@hoinhamo - Bảng Xếp Hạng</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata">
<style>
body, html {
  height: 100%;
  font-family: "Inconsolata", sans-serif;
}
.bgimg {
  background-position: center;
  background-size: cover;
  background-image: url("/image-web/header2.jpg");
  min-height: 75%;
}
</style>
</head>
<body>

<!-- Navbar -->
<div class="w3-top">
  <div class="w3-row w3-padding w3-black">
    <div class="w3-col s3"><a href="index.html" class="w3-button w3-block w3-black">NHÀ</a></div>
    <div class="w3-col s3"><a href="about.html" class="w3-button w3-block w3-black">VỀ CHÚNG MÌNH</a></div>
    <div class="w3-col s3"><a href="contact.html" class="w3-button w3-block w3-black">LIÊN KẾT</a></div>
    <div class="w3-col s3"><a href="motime.html" class="w3-button w3-block w3-black">!ĐẶC BIỆT!</a></div>
  </div>
</div>

<!-- Main Content -->
<div class="w3-container w3-padding-64 w3-light-grey">
  <h2 class="w3-center">SỐ BÀI ĐĂNG CÁC THÀNH VIÊN</h2>
  <table id="rankingTable" class="w3-table w3-bordered w3-striped w3-large w3-center">
    <!-- Dữ liệu từ Google Sheets sẽ được thêm vào đây -->
  </table>
</div>

<div class="w3-container w3-padding-64 w3-white">
  <h2 class="w3-center">BÀI ĐĂNG NỔI BẬT</h2>
  <table id="featuredPostsTable" class="w3-table w3-bordered w3-striped w3-large w3-center">
    <!-- Dữ liệu từ Google Sheets sẽ được thêm vào đây -->
  </table>
</div>

<!-- Back Home Button -->
<div class="w3-center w3-padding-64">
    <a href="index.html" class="w3-button w3-black w3-padding-large w3-round">VỀ NHÀ</a>
</div>

<!-- Footer -->
<footer class="w3-center w3-light-grey w3-padding-48 w3-large">
  <p>Template by w3.css and remake by @hoinhamo</p>
</footer>

<script>
  async function fetchGoogleSheet(url, tableId, isFeaturedPosts = false) {
    const response = await fetch(url + "&_=" + new Date().getTime());
    const text = await response.text();
    const rows = text.trim().split("\n").map(row => row.split(","));

    let table = document.getElementById(tableId);
    table.innerHTML = ""; // Xóa nội dung cũ

    // ✅ Tạo header của bảng
    let headerRow = document.createElement("tr");
    headerRow.classList.add("w3-black");

    // Nếu là bảng bài đăng nổi bật, chỉ hiển thị hai cột đầu
    let headers = isFeaturedPosts ? rows[0].slice(0, 2) : rows[0];

    headers.forEach(header => {
        let th = document.createElement("th");
        th.innerText = header;
        headerRow.appendChild(th);
    });
    table.appendChild(headerRow);

    // ✅ Thêm dữ liệu bảng với định dạng mong muốn
    for (let i = 1; i < rows.length; i++) {
        let row = document.createElement("tr");

        if (isFeaturedPosts) {
            // Chỉ hiển thị 2 cột đầu, cột thứ 3 được dùng làm link
            let postName = rows[i][1]; // Cột tiêu đề bài viết
            let postLink = rows[i][2]; // Cột chứa URL

            let tdIndex = document.createElement("td");
            tdIndex.innerText = rows[i][0]; // Chỉ số bài viết
            row.appendChild(tdIndex);

            let tdTitle = document.createElement("td");
            let link = document.createElement("a");
            link.href = postLink;
            link.target = "_blank";
            link.innerText = postName;
            tdTitle.appendChild(link);
            row.appendChild(tdTitle);
        } else {
            // Hiển thị toàn bộ dữ liệu bảng xếp hạng
            rows[i].forEach(cell => {
                let td = document.createElement("td");
                td.innerText = cell;
                row.appendChild(td);
            });
        }

        table.appendChild(row);
    }
}

// 🔹 Link Google Sheets (CSV format)
const rankingSheet = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSqFNsVD_XAHVuNjd7Uve62OMe7yo1RvTYA6U0bpUEVtRcJUcj4XT2o4KSsYLG6WplDwaieFijG9X9Q/pub?output=csv";
const featuredPostsSheet = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSDFNMBktXe4yH76HjfIDzusnyLrkLSMFYV3SfkgoBLaWq5sBxmrnSlReReI2UscZDUJ6u43mrTi51N/pub?output=csv";

// 🔹 Gọi hàm fetch dữ liệu cho cả hai bảng
fetchGoogleSheet(rankingSheet, "rankingTable");
fetchGoogleSheet(featuredPostsSheet, "featuredPostsTable", true);
</script>
</body>
</html>
