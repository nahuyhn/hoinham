"<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>T·∫•t c·∫£ b√†i vi·∫øt | H·ªôi Nh√† M∆°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <style>
    body {
      max-width: 700px;
      margin: auto;
      font-family: "Inconsolata", sans-serif;
      background-color: #f2f2f2;
      padding: 20px;
      padding-top: 56px; /* Gi·ªØ kho·∫£ng cho thanh menu */
    }
    .post {
      border: 1px solid #ccc;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      background: #fff;
      cursor: pointer;
      font-family: "Inconsolata", sans-serif;
    }
    .post img {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 6px;
    }
    .likes {
      color: #ff6b6b;
    }
    .comments-count {
      color: #777;
    }
    /* Thanh ƒëi·ªÅu h∆∞·ªõng */
    .nav-bar {
      display: flex;
      flex-wrap: wrap;
      background-color: #000;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 10;
      justify-content: center !important;
      left: 0 !important;
    }
    .nav-bar a {
      color: white;
      padding: 10px 16px;
      text-decoration: none;
      text-align: center;
      flex: 1 1 auto;
      min-width: 100px;
    }
    .nav-bar a:hover {
      background-color: #333;
    }
    /* Ph√¢n trang */
    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    .pagination button {
      padding: 8px 16px;
      margin: 0 5px;
      cursor: pointer;
      background-color: #000;
      color: white;
      border: none;
      border-radius: 4px;
    }
    .pagination button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>

  <!-- Thanh menu -->
  <div class="nav-bar">
    <a href="index.html">NH√Ä</a>
    <a href="viewpost.html">B√ÄI ƒêƒÇNG</a>
    <a href="test.html">V·ªÄ CH√öNG M√åNH</a>
    <a href="dangnhap.html">ƒêƒÇNG NH·∫¨P</a>
  </div>

  <div class="w3-content w3-padding" style="max-width:900px">
    <h2 class="w3-center">B√†i vi·∫øt t·ª´ c·ªông ƒë·ªìng H·ªôi Nh√† M∆°</h2>
    <div id="postsContainer"></div>
    <!-- Ph√¢n trang -->
    <div class="pagination">
      <button id="prevBtn" onclick="changePage('prev')" disabled>Trang tr∆∞·ªõc</button>
      <span id="pageInfo" style="margin: 0 10px; line-height: 36px;">Trang 1</span>
      <button id="nextBtn" onclick="changePage('next')">Trang sau</button>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDbKvZO0GhX-e43jJ9xhUuW7jlSqxyIHQo",
      authDomain: "hoinhamo1.firebaseapp.com",
      projectId: "hoinhamo1",
      storageBucket: "hoinhamo1.appspot.com",
      messagingSenderId: "39644722511",
      appId: "1:39644722511:web:4fe4296d138205e3d0413a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  
    let currentPage = 1;
    const pageSize = 5;
    const container = document.getElementById("postsContainer");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const pageInfo = document.getElementById("pageInfo");
  
    // L∆∞u tr·ªØ c√°c m·ªëc ƒë·∫ßu ti√™n v√† cu·ªëi c√πng c·ªßa m·ªói trang
    let firstVisibles = [null]; // null cho trang ƒë·∫ßu ti√™n
    let lastVisibles = []; // L∆∞u tr·ªØ t√†i li·ªáu cu·ªëi c√πng c·ªßa m·ªói trang
  
    function loadPosts(direction = 'next') {
  let query = db.collection("posts")
    .where("approved", "==", true)
    .orderBy("createdAt", "desc")
    .limit(pageSize);

  // N·∫øu kh√¥ng ph·∫£i trang ƒë·∫ßu ti√™n v√† ƒëang t·∫£i trang ti·∫øp theo
  if (direction === 'next' && lastVisibles[currentPage - 1]) {
    query = query.startAfter(lastVisibles[currentPage - 1]);
  }
  // N·∫øu l√† trang tr∆∞·ªõc, s·ª≠ d·ª•ng offset ƒë·ªÉ b·ªè qua c√°c b√†i vi·∫øt
  else if (direction === 'prev' && currentPage > 1) {
    query = query.startBefore(firstVisibles[currentPage - 1]);
  }

  query.get().then(snapshot => {
    container.innerHTML = ''; // X√≥a c√°c b√†i vi·∫øt c≈©

    if (snapshot.empty) {
      container.innerHTML = "<p class='w3-center'>Kh√¥ng c√≤n b√†i vi·∫øt n√†o.</p>";
      nextBtn.disabled = true;
      prevBtn.disabled = currentPage === 1;
      return;
    }

    snapshot.forEach(doc => {
      const data = doc.data();
      const postDiv = document.createElement("div");
      postDiv.className = "post";
      postDiv.innerHTML = `
        <h3><a href="post.html?id=${doc.id}">${data.title}</a></h3>
        <p>${data.content}</p>
        ${data.imageUrl ? `<img src="${data.imageUrl}" alt="·∫¢nh b√†i vi·∫øt">` : ""}
        <p><i>ƒêƒÉng b·ªüi ${data.author} - ${data.createdAt?.toDate().toLocaleString() || ""}</i></p>
        <p><span class="likes">‚ù§Ô∏è L∆∞·ª£t th√≠ch: ${data.likes || 0}</span></p>
        <p class="comments-count">üí¨ L∆∞·ª£t b√¨nh lu·∫≠n: ${data.commentsCount || 0}</p>
      `;
      container.appendChild(postDiv);
    });

    // L∆∞u tr·ªØ m·ªëc ƒë·∫ßu ti√™n v√† cu·ªëi c√πng c·ªßa trang hi·ªán t·∫°i
    if (direction === 'next' && snapshot.docs.length > 0) {
      firstVisibles[currentPage] = snapshot.docs[0];
      lastVisibles[currentPage] = snapshot.docs[snapshot.docs.length - 1];
    }

    // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t ph√¢n trang
    prevBtn.disabled = currentPage === 0;
    nextBtn.disabled = snapshot.size < pageSize;

    // C·∫≠p nh·∫≠t s·ªë trang
    pageInfo.textContent = `Trang ${currentPage}`;
  }).catch(error => {
    console.error("L·ªói khi t·∫£i b√†i vi·∫øt:", error);
    container.innerHTML = "<p class='w3-center'>L·ªói khi t·∫£i b√†i vi·∫øt.</p>";
  });
}

function changePage(direction) {
  if (direction === 'next' && !nextBtn.disabled) {
    currentPage++;
    loadPosts('next');
  } else if (direction === 'prev' && currentPage > 1) {
    currentPage--;
    loadPosts('prev');
  }
}
  // T·∫£i b√†i vi·∫øt l·∫ßn ƒë·∫ßu
loadPosts();
  </script>

</body>
</html>